<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Math for Kids</title>
  <meta name="description" content="Five new, kid-friendly math problems every day with answers. Simple, encouraging, and free." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>Daily Math for Kids</header>
  <main class="container">
    <section class="hero">
      <h1>Practice a little every day</h1>
      <p>We publish 5 new kid-friendly math problems each morning, with answers included.</p>
      <p id="today-link"><strong>Latest:</strong> checking…</p>
    </section>

    <section>
      <h2>Recent days</h2>
      <ul class="list" id="recent-list">
        <li>Loading…</li>
      </ul>
    </section>
  </main>
  <footer>© <span id="year"></span> • Auto-generated daily</footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    const BASE = location.pathname.replace(/\/$/, ''); // e.g. /dailymathforkids

    async function loadFromSitemap() {
      try {
        const res = await fetch(BASE + '/sitemap.xml', { cache: 'no-store' });
        if (!res.ok) throw new Error('no sitemap');
        const xml = new DOMParser().parseFromString(await res.text(), 'application/xml');

        // Collect only daily pages
        const urls = Array.from(xml.querySelectorAll('url loc'))
          .map(n => n.textContent)
          .filter(u => /\/daily\/\d{4}-\d{2}-\d{2}\.html$/.test(u))
          .sort((a,b) => b.localeCompare(a)); // newest first

        // Latest link
        const todayEl = document.getElementById('today-link');
        if (urls.length) {
          const latest = urls[0];
          const d = latest.match(/(\d{4}-\d{2}-\d{2})/)[1];
          todayEl.innerHTML = `<strong>Latest:</strong> <a href="${latest}">Daily Math – ${d}</a>`;
        } else {
          todayEl.textContent = 'No daily pages found yet. The first one appears after the workflow runs.';
        }

        // Recent list (up to 21)
        const recentEl = document.getElementById('recent-list');
        recentEl.innerHTML = '';
        urls.slice(0,21).forEach(u => {
          const d = u.match(/(\d{4}-\d{2}-\d{2})/)[1];
          const li = document.createElement('li');
          li.innerHTML = `<a href="${u}">Daily Math – ${d}</a>`;
          recentEl.appendChild(li);
        });
        if (!urls.length) recentEl.innerHTML = '<li>No daily pages yet.</li>';
      } catch (e) {
        document.getElementById('recent-list').innerHTML = '<li>Could not load daily list yet.</li>';
      }
    }
    loadFromSitemap();
  </script>
</body>
</html>
